<div class="content-block">
    <div class="header-content">
        <h2>Package Management</h2>
    </div>
    <div class="body-content">
        <div class="row col-md-12" style="margin: 0px;padding: 0px">
            <div class="col-md-3 form-group">
                <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.package_code" (keydown.enter)="search()" placeholder="Package code">
            </div>
            <div class="col-md-3 form-group">
                <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.tracking_code" (keydown.enter)="search()" placeholder="Tracking code">
            </div>
            <div class="col-md-3 form-group">
                <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.sku" (keydown.enter)="search()" placeholder="Sku">
            </div>
            <div class="col-md-3 form-group">
                <input class="form-control form-control-sm" type="text"  [(ngModel)]="filter.order_code" (keydown.enter)="search()" placeholder="Order Code">
            </div>
            <div class="col-md-3 form-group">
                <select class="form-control form-control-sm"  [(ngModel)]="filter.type_tracking" (change)="search()" >
                    <option value="">-- Select Type Tracking --</option>
                    <option value="NORMAL">Normal</option>
                    <option value="SPLIT">Split</option>
                    <option value="UNKNOWN">Unknown</option>
                </select>
            </div>
            <div class="col-md-3 form-group">
                <select class="form-control form-control-sm"  [(ngModel)]="filter.status" (change)="search()" >
                    <option value="">-- Select status --</option>
                    <option value="created">Delivery note created</option>
                    <option value="not_create">Delivery note not create</option>
                </select>
            </div>
            <div class="col-md-12 btn-group">
                <button id="btn-search" class="btn btn-sm btn-rounded btn-outline-secondary" (click)="search()"><i class="fal fa-search"></i> Search</button>
                <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="refresh()"><i class="fal fa-refresh"></i> Reset</button>
                <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="create1vs1()"><i class="fal fa-plus"></i> Create 1vs1 delivery note</button>
                <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="showDeliveryNoteModal()" tooltip="With items you had chosen"><i class="fal fa-plus"></i> Create delivery note</button>
            </div>
            <div class="col-md-12"  style="margin: 0px;padding: 0px">
                <div class="row list-summary">
                    <div class="col-md-6">
                        <span i18n>Showing</span>
                        <select class="form-control-sm select-custom"
                                [(ngModel)]="filter.limit" (change)="search()">
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                            <option value="200">300</option>
                            <option value="200">500</option>
                            <option value="200">1000</option>
                            <option value="all">All</option>
                        </select>
                        <span>of page {{filter.page}} in {{gettotalPage()}} page in total {{total}} items</span>
                    </div>
                    <div class="col-md-6">
                        <pagination [boundaryLinks]="true"
                                    [totalItems]="total"
                                    (pageChanged)="handlePagination($event)"
                                    [maxSize]="10"
                                    [itemsPerPage]="filter.limit" class="pagination-sm pull-right"
                                    [rotate]="false">
                        </pagination>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="body-content">
        <div class="row ">
            <div class="col-md-12">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th width="5%" ><input type="checkbox" [(ngModel)]="checkAll"  (change)="clickCheck()"  class="icheckbox_minimal-grey"> &nbsp;</th>
                        <th width="30%">Package Info</th>
                        <th width="35%">Order Info | Delivery Note Info</th>
                        <th width="30%">Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <ng-container *ngFor="let packTr of data">
                        <tr>
                            <td>
                                <input type="checkbox" *ngIf="packTr.hold != 1 && !packTr.shipment_id && !packTr.delivery_note_id"  [(ngModel)]="checkBoxs[getIdCheckBox(packTr.id)]" (change)="clickCheck()" class="icheckbox_minimal-grey">
                            </td>
                            <td>
                                <div>Status: <b>{{packTr.status}}</b></div>
                                <div>Package Code: <b>{{packTr.package_code}}</b></div>
                                <div>Tracking Code: <b>{{packTr.tracking_code}}</b></div>
                                <div>Tracking WS: <b>{{packTr.ws_tracking_code}}</b></div>
                                <div>Warehouse Tag: <b>{{packTr.warehouse_tag_boxme}}</b></div>
                                <div>Manifest Code: <b>{{packTr.manifest_code}}</b></div>
                                <div>Weight: <b>{{packTr.weight}}</b></div>
                                <div>Dimentsion: <b>{{packTr.dimention_w}}</b>x<b>{{packTr.dimention_l}}</b>x<b>{{packTr.dimention_h}}</b></div>
                                <div>Warehouse Received: <b>{{packTr.manifest.receiveWarehouse.name}}</b></div>
                                <div>Type: <b>{{packTr.type_tracking}}</b></div>
                            </td>
                            <td>
                                <ng-container *ngIf="!packTr.order">
                                    <h4 style="color: red">Cannot find order {{packTr.order_id ? 'with order id ' + packTr.order_id: ''}}!</h4>
                                    <div>
                                        <p class="btn-group" >
                                            <input class="form-control form-control-sm" [(ngModel)]="productIds[packTr.id]" type="text" placeholder="Fill Product Id">
                                            <button class="btn btn-sm btn-outline-dark" (click)="mapUnknown(packTr.id, packTr.tracking_code)" >Map <i class="fal fa-map-marker"></i></button>
                                        </p>
                                    </div>
                                    <hr>
                                </ng-container>
                                <ng-container *ngIf="packTr.order">
                                    <div>Order Code: <b>{{packTr.order.ordercode}}</b></div>
                                    <div>Customer Id: <b>{{packTr.order.customer_id}}</b></div>
                                    <div>Receiver: <b>{{packTr.order.receiver_name}} / {{packTr.order.receiver_phone}} / {{packTr.order.receiver_address}}
                                                ( {{packTr.order.receiver_district_name}}, {{packTr.order.receiver_province_name}}  ){{packTr.order.receiver_post_code ? ' ('+packTr.order.receiver_post_code+')' : ''}}</b></div>
                                    <hr>
                                </ng-container>
                                <ng-container>
                                    <div class="row col-md-12">
                                        <div class="col-md-12">
                                            <h5>Delivery Note</h5>
                                        </div>
                                    </div>
                                    <div class="row col-md-12" *ngIf="packTr.delivery_note_code">
                                        <div class="col-md-9">
                                            <a target="_blank" href="/operation/delivery-note?deliveryNoteCode={{packTr.delivery_note_code}}">{{packTr.delivery_note_code}}</a>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-dark" (click)="outOfDeliveryNote(packTr.id)" tooltip="Out of delivery note"><i class="fal fa-sign-out"></i></button>
                                                <button class="btn btn-sm btn-outline-dark" tooltip="History delivery note"><i class="fal fa-history"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row col-md-12" *ngIf="!packTr.delivery_note_code">
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-dark"  (click)="checkBoxs[getIdCheckBox(packTr.id)] = true;showDeliveryNoteModal()" tooltip="Join or create delivery note"><i class="fal fa-plus"></i></button>
                                            </div>
                                    </div>
                                </ng-container>
                            </td>
                            <td>
                                <div class="row col-md-12 show-status" *ngIf="packTr.stock_in_us">
                                    <div class="col-md-6">
                                        Kho mỹ
                                    </div>
                                    <div class="col-md-6">
                                        {{ packTr.stock_in_us * 1000 | date:'dd/MM/yyyy HH:mm:ss '}}
                                    </div>
                                </div>
                                <div class="row col-md-12 show-status" *ngIf="packTr.stock_in_us && packTr.stock_out_us">
                                    <div class="col-md-6">
                                        Vận chuyển QT
                                    </div>
                                    <div class="col-md-6">
                                        {{ packTr.stock_out_us * 1000 | date:'dd/MM/yyyy HH:mm:ss '}}
                                    </div>
                                </div>
                                <div class="row col-md-12 show-status" *ngIf="packTr.stock_in_us && packTr.stock_out_us && packTr.stock_in_local">
                                    <div class="col-md-6">
                                        Kho Việt Nam
                                    </div>
                                    <div class="col-md-6">
                                        {{ packTr.stock_in_local  * 1000 | date:'dd/MM/yyyy HH:mm:ss '}}
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </ng-container>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div  class="action-delivery-note" *ngIf="checkItemCheckBox()">
    <a  class="btn btn-success" href="javascript:;" (click)="showDeliveryNoteModal()">
        <i  class="fa fa-plus"></i> Create or Join ({{checkItemCheckBox()}} packages)
    </a>
</div>
<div bsModal #insertTrackingModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body p-0">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card m-b-0">
                            <div class="card-body">
                                <div class="card-title">
                                    <h3 i18n>Delivery note</h3>
                                </div>
                                <div class="col-md-12 form-body">
                                    <div class="row body-content">
                                        <div class="col-md-12">
                                            <h5>
                                                Receiver info &nbsp;
                                                <a href="javascript: void (0);" (click)="showInfoReceiver = !showInfoReceiver;"><i class="fa fa-toggle-{{showInfoReceiver ? 'on' : 'off'}}"></i></a>
                                            </h5>
                                        </div>
                                        <div class="row col-md-12" *ngIf="showInfoReceiver">
                                            <div class="col-md-6 form-group m-b-10">
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-user"></i></div>
                                                    <input class="form-control form-control-sm" placeholder="Full Name"  [(ngModel)]="formCreate.receiver_name" >
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-envelope"></i></div>
                                                    <input class="form-control form-control-sm" placeholder="Email" [(ngModel)]="formCreate.receiver_email" >
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-phone"></i></div>
                                                    <input class="form-control form-control-sm" placeholder="Phone Number" [(ngModel)]="formCreate.receiver_phone" >
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                                    <input class="form-control form-control-sm" placeholder="PostCode" [(ngModel)]="formCreate.receiver_post_code" >
                                                </div>
                                            </div>
                                            <div class="col-md-6 form-group m-b-10">
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-globe"></i></div>
                                                    <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_country_id" (change)="getChangeCountries()">
                                                        <option>--Select Country--</option>
                                                        <option *ngFor="let c of countries" value="{{c.id}}">{{c.name}}</option>
                                                    </select>
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                                    <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_province_id" (change)="getChangeProvinces()">
                                                        <option>--Select Province--</option>
                                                        <option *ngFor="let p of provinces" value="{{p.id}}">{{p.name}}</option>
                                                    </select>
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                                    <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_district_id" (change)="getChangeDistricts()">
                                                        <option>--Select District--</option>
                                                        <option *ngFor="let d of districts" value="{{d.id}}">{{d.name}}</option>
                                                    </select>
                                                </div>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                                    <input class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_address"  placeholder="Address"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <hr>
                                        </div>
                                    </div>
                                    <div class="row body-content">
                                        <div class="col-md-12 form-group m-b-10">
                                            <table class="table table-striped table-sm table-border-all">
                                                <thead>
                                                <tr>
                                                    <th colspan="7">Package list</th>
                                                </tr>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Package code</th>
                                                    <th>Length</th>
                                                    <th>Width</th>
                                                    <th>Height</th>
                                                    <th>Weight</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <ng-container *ngFor="let track of listChoose; let ind = index">
                                                    <tr *ngIf="checkBoxs[getIdCheckBox(track.id)]">
                                                        <td>{{ind+1}}</td>
                                                        <td>{{track.package_code}}</td>
                                                        <td>{{track.dimension_l}} cm</td>
                                                        <td>{{track.dimension_w}} cm</td>
                                                        <td>{{track.dimension_h}} cm</td>
                                                        <td>{{track.weight}} gram</td>
                                                        <td><button class="btn btn-sm btn-outline-danger" (click)="removeList(track.id)" ><i class="fal fa-trash"></i></button></td>
                                                    </tr>
                                                </ng-container>
                                                <tr>
                                                    <td colspan="7">
                                                        <b>Total Weight: </b>{{totalWeight}} gram
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="btn-group">
                                                <button class="btn btn-sm {{chooseTabCreate ? 'btn-primary' : 'btn-outline-primary'}}" (click)="chooseTabCreate = true"><i class="fa fa-plus"></i> Create</button>
                                                <button class="btn btn-sm {{!chooseTabCreate ? 'btn-primary' : 'btn-outline-primary'}}" (click)="chooseTabCreate = false"><i class="fa fa-sign-in"></i> Join</button>
                                            </div>
                                        </div>
                                        <div class="col-md-12 body-content">
                                            <ng-container *ngIf="chooseTabCreate">
                                                <table class="table">
                                                    <tr>
                                                        <th>Length</th>
                                                        <th>Width</th>
                                                        <th>Height</th>
                                                        <th>Weight</th>
                                                    </tr>
                                                    <tr>
                                                        <td><input type="text" [(ngModel)]="formCreate.length" class="form-control form-control-sm" ></td>
                                                        <td><input type="text" [(ngModel)]="formCreate.width" class="form-control form-control-sm" ></td>
                                                        <td><input type="text" [(ngModel)]="formCreate.height" class="form-control form-control-sm" ></td>
                                                        <td><input type="text" [(ngModel)]="formCreate.weight" [value]="totalWeight" class="form-control form-control-sm" ></td>
                                                    </tr>
                                                </table>
                                            </ng-container>
                                            <ng-container *ngIf="!chooseTabCreate">

                                            </ng-container>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="button-group">
                                                <button class="btn btn-sm btn-success" i18n (click)="createDeliveryNote()">Insert Tracking</button>
                                                <button class="btn btn-sm btn-warning" (click)="insertTrackingModal.hide()" i18n>Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>