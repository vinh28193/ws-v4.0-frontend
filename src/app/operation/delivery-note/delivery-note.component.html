<div class="content-block">
  <div class="header-content">
    <h2>Delivery Note Management</h2>
  </div>
  <div class="body-content">
    <div class="row col-md-12" style="margin: 0px;padding: 0px">
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.delivery_note_code" (keydown.enter)="search()" placeholder="Delivery Note code">
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.package_code" (keydown.enter)="search()" placeholder="Package code">
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.tracking_code" (keydown.enter)="search()" placeholder="Tracking code">
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.sku" (keydown.enter)="search()" placeholder="Sku">
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text"  [(ngModel)]="filter.order_code" (keydown.enter)="search()" placeholder="Order Code">
      </div>
      <div class="col-md-3 form-group">
        <select class="form-control form-control-sm"  [(ngModel)]="filter.type_tracking" (change)="search()" >
          <option value="">-- Select Type Tracking --</option>
          <option value="NORMAL">Normal</option>
          <option value="SPLIT">Split</option>
          <option value="UNKNOWN">Unknown</option>
        </select>
      </div>
      <div class="col-md-3 form-group">
        <select class="form-control form-control-sm"  [(ngModel)]="filter.status" (change)="search()" >
          <option value="">-- Select status --</option>
          <option value="created">Shipment Created</option>
          <option value="not_create">Shipment None</option>
        </select>
      </div>
      <div class="col-md-12 btn-group">
        <button id="btn-search" class="btn btn-sm btn-rounded btn-outline-secondary" (click)="search()"><i class="fa fa-search"></i> Search</button>
        <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="refresh()"><i class="fa fa-refresh"></i> Reset</button>
        <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="refresh()"><i class="fa fa-link"></i> Merge Note</button>
        <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="refresh()"><i class="fa fa-truck"></i> Stock Out</button>
      </div>
      <div class="col-md-12"  style="margin: 0px;padding: 0px">
        <div class="row list-summary">
          <div class="col-md-6">
            <span i18n>Showing</span>
            <select class="form-control-sm select-custom"
                    [(ngModel)]="filter.limit" (change)="search()">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="all">All</option>
            </select>
            <span>of page {{filter.page}} in {{gettotalPage()}} page in total {{totalCount}} items</span>
          </div>
          <div class="col-md-6">
            <pagination [boundaryLinks]="true"
                        [totalItems]="totalCount"
                        (pageChanged)="handlePagination($event)"
                        [maxSize]="10"
                        [itemsPerPage]="filter.limit" class="pagination-sm pull-right"
                        [rotate]="false">
            </pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="body-content">
    <div class="row ">
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
          <tr>
            <th width="5%" ><input type="checkbox" [(ngModel)]="checkAll"  (change)="clickCheck()"  class="icheckbox_minimal-grey"> &nbsp;</th>
            <th width="30%">Delivery Note Info</th>
            <th width="65%">Customer | Receiver & Package List</th>
          </tr>
          </thead>
          <tbody>
          <ng-container *ngFor="let packTr of data">
            <tr>
              <td>
                <input type="checkbox" *ngIf="!packTr.shipment_id"  [(ngModel)]="checkBoxs[getIdCheckBox(packTr.id)]" (change)="clickCheck()" class="icheckbox_minimal-grey">
              </td>
              <td>
                <div>Status: <b>{{packTr.current_status}}</b></div>
                <div>Delivery Code: <b>{{packTr.delivery_note_code}}</b></div>
                <div>Total Package: <b>{{packTr.packages.length}}</b></div>
                <div>Weight: <b>{{packTr.delivery_note_weight}}</b></div>
                <div>Dimention: <b>{{packTr.delivery_note_change_weight}} gram</b> ({{packTr.delivery_note_dimension_l}} x {{packTr.delivery_note_dimension_w}} x {{packTr.delivery_note_dimension_h}} cm)</div>
                <div>Warehouse Received: <b>{{packTr.warehouse ? packTr.warehouse.name : ''}}</b></div>
              </td>
              <td style="padding-right: 0px">
                <div class="row col-md-12" style="padding-right: 0px; margin: 0px">
                  <div class="col-md-6  mr-0">
                    <h6>Customer</h6>
                    <div class="border-left">
                      <div><i class="fa fa-id-badge col-ico"></i> <b>{{packTr.customer_id}}</b></div>
                      <div>{{packTr.customer ? packTr.customer.email : ''}}/{{packTr.customer ? packTr.customer.phone : ''}}</div>
                    </div>
                    <br>
                    <h6 style="color: #00a8ff">Receiver</h6>
                    <div class="border-left"  style="border-left-color: #00a8ff">
                      <div><i class="fa fa-user col-ico"></i> <b>{{packTr.receiver_name}}</b></div>
                      <div><i class="fa fa-phone col-ico"></i> {{packTr.receiver_phone}}</div>
                      <div><i class="fa fa-envelope col-ico"></i> {{packTr.receiver_email}}</div>
                      <div><i class="fa fa-map-marker col-ico"></i> {{packTr.receiver_address}}</div>
                      <div>({{packTr.receiver_district_name}}, {{packTr.receiver_province_name}}, {{packTr.receiver_country_name}}{{packTr.receiver_post_code ? ' - ' + packTr.receiver_post_code : ''}})</div>
                    </div>
                  </div>
                  <div class="col-md-6  mr-0 p-0">
                    <table class="table table-striped">
                      <tr>
                        <th>[&nbsp;{{packTr.packages.length}}&nbsp;]</th>
                        <th>Package Code</th>
                        <th>Order Code</th>
                        <th>Weight</th>
                      </tr>
                      <tr *ngFor="let package_tmp of packTr.packages; let ind = index">
                        <td>{{ind+1}}</td>
                        <td><a href="/operation/package?packageCode={{package_tmp.package_code}}" target="_blank">{{package_tmp.package_code}}</a> &nbsp;&nbsp;<i class="fa fa-sign-out-alt" style="cursor: pointer" title="Remove from delivery note" (click)="outOfDeliveryNote(package_tmp.id)"></i></td>
                        <td><a href="/operation/order?orderCode={{package_tmp.order.ordercode}}" target="_blank">{{package_tmp.order.ordercode}}</a></td>
                        <td>{{package_tmp.weight}} gram</td>
                      </tr>
                    </table>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div  class="action-delivery-note" *ngIf="checkItemCheckBox()">
  <a  class="btn btn-success" href="javascript:;" (click)="showDeliveryNoteModal()">
    <i  class="fa fa-plus"></i> Create or Join ({{checkItemCheckBox()}} packages)
  </a>
</div>
<div bsModal #insertTrackingModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" style="max-width: 80%">
    <div class="modal-content">
      <div class="modal-body p-0">
        <div class="row">
          <div class="col-md-12">
            <div class="card m-b-0">
              <div class="card-body">
                <div class="card-title">
                  <h3 i18n>Shipment</h3>
                </div>
                <div class="col-md-12 form-body">
                  <div class="row body-content">
                    <div class="col-md-8">
                      <div class="row body-content">
                        <div class="col-md-12" >
                          <h6>1. Warehouse Pick Up</h6>
                          <div class="input-group">
                            <div class="input-group-addon"><i class="fa fa-warehouse"></i></div>
                            <select class="form-control form-control-sm" [(ngModel)]="formCreate.warehouse_pickup">
                              <option>--Select Pickup--</option>
                              <option *ngFor="let w of warehouses" value="{{w.id}}">{{w.name}}</option>
                            </select>
                          </div>
                          <div><hr></div>
                          <h6>2. Receiver Info</h6>
                          <div class="row">
                            <div class="col-md-6">
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-user"></i></div>
                                <input class="form-control form-control-sm" placeholder="Full Name"  [(ngModel)]="formCreate.receiver_name" >
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-envelope"></i></div>
                                <input class="form-control form-control-sm" placeholder="Email" [(ngModel)]="formCreate.receiver_email" >
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-phone"></i></div>
                                <input class="form-control form-control-sm" placeholder="Phone Number" [(ngModel)]="formCreate.receiver_phone" >
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <input class="form-control form-control-sm" placeholder="PostCode" [(ngModel)]="formCreate.receiver_post_code" >
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-globe"></i></div>
                                <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_country_id" (change)="getChangeCountries()">
                                  <option>--Select Country--</option>
                                  <option *ngFor="let c of countries" value="{{c.id}}">{{c.name}}</option>
                                </select>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_province_id" (change)="getChangeProvinces()">
                                  <option>--Select Province--</option>
                                  <option *ngFor="let p of provinces" value="{{p.id}}">{{p.name}}</option>
                                </select>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_district_id" (change)="getChangeDistricts()">
                                  <option>--Select District--</option>
                                  <option *ngFor="let d of districts" value="{{d.id}}">{{d.name}}</option>
                                </select>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <input class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_address"  placeholder="Address"/>
                              </div>
                            </div>
                          </div>
                          <div><hr></div>
                          <h6>3. Config Shipment</h6>
                          <div class="row">
<!--                            <div class="col-md-1" style="padding-right: 0px">-->
<!--                              <input style="width: 20px;height: 20px; right: 0px;" [(ngModel)]="" type="checkbox" >-->
<!--                            </div>-->
<!--                            <div class="col-md-3" style="border-right: 1px solid #32383e">-->
<!--                              Insurance-->
<!--                            </div>-->
                            <div class="col-md-1"  style="padding-right: 0px">
                              <input style="width: 20px;height: 20px; right: 0px;" type="checkbox" [(ngModel)]="formCreate.pack_wood" >
                            </div>
                            <div class="col-md-3">
                              Pack Wood
                            </div>
                          </div>
                          <div><hr></div>
                        </div>
                        <div class="col-md-12">
                          <hr>
                        </div>
                        <div class="col-md-12">
                          <h6>Total delivery</h6>
                          <hr>
                          <table class="table table-sm">
                            <tr>
                              <th>Price</th>
                              <th>COD</th>
                              <th>Length (cm)</th>
                              <th>Width (cm)</th>
                              <th>Height (cm)</th>
                              <th>Weight (gram)</th>
                            </tr>
                            <tr>
                              <td><input type="text" [(ngModel)]="formCreate.price" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.cod" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.length" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.width" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.height" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.weight" [value]="totalWeight" class="form-control form-control-sm" ></td>
                            </tr>
                          </table>
                        </div>
                        <div class="col-md-12">
                          <hr>
                        </div>
                        <div class="col-md-12">
                          <table class="table table-striped table-sm table-border-all">
                            <thead>
                            <tr>
                              <th colspan="8">Package list</th>
                            </tr>
                            <tr>
                              <th>#</th>
                              <th>Package code</th>
                              <th>Price</th>
                              <th>COD</th>
                              <th>Length (cm)</th>
                              <th>Width (cm)</th>
                              <th>Height (cm)</th>
                              <th>Weight (gram)</th>
                            </tr>
                            </thead>
                            <tbody>
                            <ng-container *ngFor="let track of listPackages; let ind = index">
                              <tr>
                                <td>{{ind+1}}</td>
                                <td>{{track.package_code}}</td>
                                <td>{{track.cod}}</td>
                                <td>{{track.price}}</td>
                                <td>{{track.dimension_l}}</td>
                                <td>{{track.dimension_w}}</td>
                                <td>{{track.dimension_h}}</td>
                                <td>{{track.weight}}</td>
                              </tr>
                            </ng-container>
                            <tr>
                              <td colspan="8">
                                <b>Total Weight: </b>{{totalWeight}} gram
                              </td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <h6>4. Courier info &nbsp; &nbsp;<a href="javascript: void(0);" (click)="suggestCourier()"><i class="fa fa-refresh" ></i></a></h6>
                      Has {{listCourier ? listCourier.length : 0}} couriers.
                      <div >
                        <ng-container *ngFor="let courier of listCourier">
                            <div class="row col-md-12">
                                <div class="col-md-3">
                                    <img src="{{courier.courier_logo}}" class="img-responsive">
                                </div>
                                <div class="row col-md-9">
                                    <div class="col-md-12"><b>{{courier.courier_name}}</b> ({{courier.service_code}})</div>
                                    <div  class="col-md-6"><i>{{courier.min_delivery_time}} day - {{courier.max_delivery_time}} day</i></div>
                                    <div  class="col-md-6"><i>{{courier.shipping_fee | number}} đ</i></div>
                                </div>
                            </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="button-group">
                        <button class="btn btn-sm btn-warning" (click)="insertTrackingModal.hide()" i18n>Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>