<div class="content-block">
  <div class="header-content">
    <h2 i18n>Delivery Note Management</h2>
  </div>
  <div class="body-content">
    <div class="row col-md-12" style="margin: 0px;padding: 0px">
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.manifest_code" (keydown.enter)="search()" placeholder="Manifest code" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.delivery_note_code" (keydown.enter)="search()" placeholder="Delivery Note code" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.package_code" (keydown.enter)="search()" placeholder="Package code" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.tracking_code" (keydown.enter)="search()" placeholder="Tracking code" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text" [(ngModel)]="filter.sku" (keydown.enter)="search()" placeholder="Sku" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text"  [(ngModel)]="filter.order_code" (keydown.enter)="search()" placeholder="Order Code" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <input class="form-control form-control-sm" type="text"  [(ngModel)]="filter.customer_id" (keydown.enter)="search()" placeholder="Customer Id" i18n-placeholder>
      </div>
      <div class="col-md-3 form-group">
        <select class="form-control form-control-sm"  [(ngModel)]="filter.type_tracking" (change)="search()" >
          <option value="" i18n>-- Select Type Tracking --</option>
          <option value="NORMAL" i18n>Normal</option>
          <option value="SPLIT" i18n>Split</option>
          <option value="UNKNOWN" i18n>Unknown</option>
        </select>
      </div>
      <div class="col-md-3 form-group">
        <select class="form-control form-control-sm"  [(ngModel)]="filter.status" (change)="search()" >
          <option value="" i18n>-- Select status --</option>
          <option value="created" i18n>Shipment Created</option>
          <option value="not_create" i18n>Shipment None</option>
        </select>
      </div>
      <div class="col-md-12 btn-group">
        <button id="btn-search" class="btn btn-sm btn-rounded btn-outline-secondary" (click)="search()" i18n><i class="fa fa-search"></i> Search</button>
        <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="refresh()" i18n><i class="fa fa-refresh"></i> Reset</button>
          <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="merge()" i18n><i class="fa fa-link"></i>
              Merge Note
          </button>
        <button class="btn btn-sm btn-rounded btn-outline-secondary" (click)="refresh()" i18n><i class="fa fa-truck"></i> Create Shipment Fast</button>
      </div>
      <div class="col-md-12"  style="margin: 0px;padding: 0px">
        <div class="row list-summary">
          <div class="col-md-6">
            <span i18n>Showing</span>
            <select class="form-control-sm select-custom"
                    [(ngModel)]="filter.limit" (change)="search()">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="200">300</option>
              <option value="200">500</option>
              <option value="200">1000</option>
              <option value="all" i18n>All</option>
            </select>
            <span i18n>of page {{filter.page}} in {{gettotalPage()}} page in total {{totalCount}} items</span>
          </div>
          <div class="col-md-6">
            <pagination [firstText]="'<<'"
                        [lastText]="'>>'"
                        [nextText]="'>'"
                        [previousText]="'<'"
                        [boundaryLinks]="true"
                        [totalItems]="totalCount"
                        (pageChanged)="handlePagination($event)"
                        [maxSize]="10"
                        [itemsPerPage]="filter.limit" class="pagination-sm pull-right"
                        [rotate]="false">
            </pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="body-content">
    <div class="row ">
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
          <tr>
            <th width="5%" ><input type="checkbox" [(ngModel)]="checkAll"  (change)="clickCheck()"  class="icheckbox_minimal-grey"> &nbsp;</th>
            <th width="20%" i18n>Delivery Note Info</th>
            <th width="75%" i18n>Customer | Receiver & Package List</th>
          </tr>
          </thead>
          <tbody>
          <ng-container *ngFor="let packTr of data">
            <tr>
              <td>
                <input type="checkbox" *ngIf="!packTr.shipment_id"  [(ngModel)]="checkBoxs[getIdCheckBox(packTr.id)]" (change)="clickCheck()" class="icheckbox_minimal-grey">
              </td>
                <td>
                    <div i18n>Status: <b>{{packTr.current_status}}</b></div>
                    <div i18n>Delivery Code: <b>{{packTr.delivery_note_code}}</b></div>
                    <div i18n>Total Package: <b>{{packTr.packages.length}}</b></div>
                    <div i18n>Weight: <b>{{packTr.delivery_note_weight}}</b></div>
                    <div i18n>Dimention: <b>{{packTr.delivery_note_change_weight}} gram</b>
                        ({{packTr.delivery_note_dimension_l}} x {{packTr.delivery_note_dimension_w}}
                        x {{packTr.delivery_note_dimension_h}} cm)
                    </div>
                    <div i18n>Warehouse Received: <b>{{packTr.warehouse ? packTr.warehouse.name : ''}}</b></div>
                    <div i18n>Manifest Codes: <b>{{packTr.manifest_code}}</b></div>
                    <div *ngIf="packTr.shipment_id" i18n>Shipment Code:
                        <b>{{packTr.shipment ? packTr.shipment.shipment_code : ''}}</b></div>
                </td>
              <td style="padding-right: 0px">
                <div class="row col-md-12" style="padding-right: 0px; margin: 0px">
                    <div class="col-md-5 mr-0">
                    <h6 i18n>Customer</h6>
                    <div class="border-left">
                      <div><i class="fa fa-id-badge col-ico"></i> <b>{{packTr.customer_id}}</b> &nbsp;&nbsp;<i style="cursor: pointer" class="fa fa-filter" (click)="filter.customer_id = packTr.customer_id; search()"></i></div>
                      <div>{{packTr.customer ? packTr.customer.email : ''}}/{{packTr.customer ? packTr.customer.phone : ''}}</div>
                    </div>
                    <br>
                    <h6 style="color: #00a8ff" i18n>Receiver</h6>
                    <div class="border-left"  style="border-left-color: #00a8ff">
                      <div><i class="fa fa-user col-ico"></i> <b>{{packTr.receiver_name}}</b></div>
                      <div><i class="fa fa-phone col-ico"></i> {{packTr.receiver_phone}}</div>
                      <div><i class="fa fa-envelope col-ico"></i> {{packTr.receiver_email}}</div>
                      <div><i class="fa fa-map-marker col-ico"></i> {{packTr.receiver_address}}</div>
                      <div>({{packTr.receiver_district_name}}, {{packTr.receiver_province_name}}, {{packTr.receiver_country_name}}{{packTr.receiver_post_code ? ' - ' + packTr.receiver_post_code : ''}})</div>
                    </div>
                  </div>
                    <div class="col-md-7 p-0">
                    <table class="table table-striped">
                      <tr>
                        <th>[&nbsp;{{packTr.packages.length}}&nbsp;]</th>
                        <th i18n>Package Code</th>
                        <th i18n>Order Code</th>
                        <th i18n>Warehouse Tag</th>
                        <th i18n>Weight</th>
                      </tr>
                      <tr *ngFor="let package_tmp of packTr.packages; let ind = index">
                        <td>{{ind+1}}</td>
                        <td><a href="/operation/package?packageCode={{package_tmp.package_code}}" target="_blank">{{package_tmp.package_code}}</a> &nbsp;&nbsp;<i class="fa fa-sign-out-alt" style="cursor: pointer" title="Remove from delivery note" (click)="outOfDeliveryNote(package_tmp.id)" i18n-title></i></td>
                        <td><a href="/operation/order?orderCode={{package_tmp.order.ordercode}}" target="_blank">{{package_tmp.order.ordercode}}</a></td>
                          <td><i>{{package_tmp.warehouse_tag_boxme}}</i></td>
                        <td>{{package_tmp.weight}} gram</td>
                      </tr>
                    </table>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div  class="action-delivery-note" *ngIf="checkItemCheckBox()">
  <div class="btn-group">
      <a class="badge badge-danger" href="javascript:void (0)" (click)="merge()" i18n>
      <i  class="fa fa-link"></i> Merge ({{checkItemCheckBox()}} packages)
    </a>
    <a class="badge badge-danger" href="javascript:void (0)" (click)="showDeliveryNoteModal()" i18n>
      <i  class="fa fa-plus"></i> Create Shipment ({{checkItemCheckBox()}} packages)
    </a>
  </div>
</div>
<div  class="action-delivery-note" *ngIf="!checkItemCheckBox()">
  <div class="btn-group">
    <a class="badge badge-info" ><i class="fa fa-tools"></i></a>
  </div>
</div>
<div bsModal #insertTrackingModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
     aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" style="max-width: 80%">
    <div class="modal-content">
      <div class="modal-body p-0">
        <div class="row">
          <div class="col-md-12">
            <div class="card m-b-0">
              <div class="card-body">
                <div class="card-title">
                  <h3 i18n>Shipment</h3>
                </div>
                <div class="col-md-12 form-body">
                  <div class="row body-content">
                    <div class="col-md-8">
                      <div class="row body-content">
                        <div class="col-md-12" >
                          <h6  i18n>1. Warehouse Pick Up</h6>
                          <div class="input-group">
                            <div class="input-group-addon"><i class="fa fa-warehouse"></i></div>
                            <select class="form-control form-control-sm" [(ngModel)]="formCreate.warehouse_pickup" (change)="suggestCourier()">
                              <option i18n>--Select Pickup--</option>
                              <option *ngFor="let w of warehouses" value="{{w.id}}">{{w.name}}</option>
                            </select>
                          </div>
                          <div><hr></div>
                          <h6 i18n>2. Receiver Info</h6>
                          <div class="row">
                            <div class="col-md-6">
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-user"></i></div>
                                <input class="form-control form-control-sm" placeholder="Full Name"  [(ngModel)]="formCreate.receiver_name"  i18n-placeholder>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-envelope"></i></div>
                                <input class="form-control form-control-sm" placeholder="Email" [(ngModel)]="formCreate.receiver_email"  i18n-placeholder>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-phone"></i></div>
                                <input class="form-control form-control-sm" placeholder="Phone Number" [(ngModel)]="formCreate.receiver_phone" i18n-placeholder>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <input class="form-control form-control-sm" placeholder="PostCode" [(ngModel)]="formCreate.receiver_post_code" (change)="suggestCourier()" i18n-placeholder>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-globe"></i></div>
                                <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_country_id" (change)="getChangeCountries()">
                                  <option i18n>--Select Country--</option>
                                  <option *ngFor="let c of countries" value="{{c.id}}">{{c.name}}</option>
                                </select>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_province_id" (change)="getChangeProvinces()">
                                  <option i18n>--Select Province--</option>
                                  <option *ngFor="let p of provinces" value="{{p.id}}">{{p.name}}</option>
                                </select>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <select class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_district_id" (change)="getChangeDistricts()">
                                  <option i18n>--Select District--</option>
                                  <option *ngFor="let d of districts" value="{{d.id}}">{{d.name}}</option>
                                </select>
                              </div>
                              <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-map-marker"></i></div>
                                <input class="form-control form-control-sm" [(ngModel)]="formCreate.receiver_address"  placeholder="Address"/>
                              </div>
                            </div>
                          </div>
                          <div><hr></div>
                          <h6 i18n>3. Config Shipment</h6>
                          <div class="row">
<!--                            <div class="col-md-1" style="padding-right: 0px">-->
<!--                              <input style="width: 20px;height: 20px; right: 0px;" [(ngModel)]="" type="checkbox" >-->
<!--                            </div>-->
<!--                            <div class="col-md-3" style="border-right: 1px solid #32383e">-->
<!--                              Insurance-->
<!--                            </div>-->
                            <div class="col-md-1"  style="padding-right: 0px">
                              <input style="width: 20px;height: 20px; right: 0px;" type="checkbox" [(ngModel)]="formCreate.pack_wood" >
                            </div>
                            <div class="col-md-3" i18n>
                              Pack Wood
                            </div>
                          </div>
                          <div><hr></div>
                        </div>
                        <div class="col-md-12">
                          <hr>
                        </div>
                        <div class="col-md-12">
                          <h6 i18n>Total delivery</h6>
                          <hr>
                          <table class="table table-sm">
                            <tr>
                              <th i18n>Price</th>
                              <th i18n>COD</th>
                              <th i18n>Length (cm)</th>
                              <th i18n>Width (cm)</th>
                              <th i18n>Height (cm)</th>
                              <th i18n>Weight (gram)</th>
                            </tr>
                            <tr>
                              <td><input type="text" [(ngModel)]="formCreate.price" class="form-control form-control-sm" (change)="suggestCourier()" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.cod" class="form-control form-control-sm"  (change)="suggestCourier()"  ></td>
                              <td><input type="text" [(ngModel)]="formCreate.length" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.width" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.height" class="form-control form-control-sm" ></td>
                              <td><input type="text" [(ngModel)]="formCreate.weight" [value]="totalWeight" class="form-control form-control-sm"  (change)="suggestCourier()"></td>
                            </tr>
                          </table>
                        </div>
                        <div class="col-md-12">
                          <hr>
                        </div>
                        <div class="col-md-12">
                          <table class="table table-striped table-sm table-border-all">
                            <thead>
                            <tr>
                              <th colspan="8" i18n>Package list</th>
                            </tr>
                            <tr>
                              <th>#</th>
                              <th i18n>Package code</th>
                              <th i18n>Price</th>
                              <th i18n>COD</th>
                              <th i18n>Length (cm)</th>
                              <th i18n>Width (cm)</th>
                              <th i18n>Height (cm)</th>
                              <th i18n>Weight (gram)</th>
                            </tr>
                            </thead>
                            <tbody>
                            <ng-container *ngFor="let track of listPackages; let ind = index">
                              <tr>
                                <td>{{ind+1}}</td>
                                <td>{{track.package_code}}</td>
                                <td>{{track.price}}</td>
                                <td>{{track.cod}}</td>
                                <td>{{track.dimension_l}}</td>
                                <td>{{track.dimension_w}}</td>
                                <td>{{track.dimension_h}}</td>
                                <td>{{track.weight}}</td>
                              </tr>
                            </ng-container>
                            <tr>
                              <td colspan="8">
                                <b i18n>Total Weight: </b>{{totalWeight}} gram
                              </td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <h6 i18n>4. Courier info &nbsp; &nbsp;<a href="javascript: void(0);" (click)="suggestCourier()"><i class="fa fa-refresh" ></i></a></h6>
                      <i i18n>Has <b style="color: red">{{listCourier ? listCourier.length : 0}}</b> couriers.</i>
                      <div class="row" style="max-height: 350px; overflow: auto;" >
                        <ng-container *ngFor="let courier of listCourier">
                            <div class="item-courier{{courier.service_id == formCreate.courier.service_id ? '-selected' : ''}}" (click)="selectCourier(courier)">
                                <div class="col-md-3" style="float: left">
                                    <img src="{{courier.courier_logo}}" class="img-responsive" style="margin: 5px; width: 90%">
                                </div>
                                <div class="row col-md-9"  style="height: 100%;margin: 0px;float: right; padding-right: 0px; padding-left: 0px;">
                                    <div class="col-md-12"><b>{{courier.courier_name}}</b> ({{courier.service_code}})</div>
                                    <div  class="col-md-6" style="text-align: left" i18n><i>{{courier.min_delivery_time}} day - {{courier.max_delivery_time}} day</i></div>
                                    <div  class="col-md-6" style="text-align: right"><i>{{courier.shipping_fee | number}} đ</i></div>
                                </div>
                            </div>
                        </ng-container>
                      </div>
                      <div><hr></div>
                      <div class="row">
                        <div class="item-courier-selected" *ngIf="formCreate.courier.service_id">
                          <div class="col-md-3" style="float: left">
                            <img src="{{formCreate.courier.courier_logo}}" class="img-responsive" style="margin: 5px; width: 90%">
                          </div>
                          <div class="row col-md-9"  style="height: 100%;margin: 0px;float: right; padding-right: 0px; padding-left: 0px;">
                            <div class="col-md-12"><b>{{formCreate.courier.courier_name}}</b> ({{formCreate.courier.service_code}})</div>
                            <div  class="col-md-6" style="text-align: left"><i>{{formCreate.courier.min_delivery_time}} day - {{formCreate.courier.max_delivery_time}} day</i></div>
                            <div  class="col-md-6" style="text-align: right"><i>{{formCreate.courier.shipping_fee | number}} đ</i></div>
                          </div>
                        </div>
                        <div *ngIf="!formCreate.courier.service_id">
                          <h5 style="color: red" i18n>Please select courier!</h5>
                        </div>
                      </div>
                      <div class="row" style="border-bottom: 1px dashed #3e3e3e3e">
                        <div class="col-md-6" i18n><b>COD:</b></div>
                        <div class="col-md-6 text-right">
                          <b style="color: red" *ngIf="formCreate.cod || formCreate.cod == 0">{{formCreate.cod | number}} đ</b>
                          <b style="color: red" *ngIf="!formCreate.cod && formCreate.cod != 0">---</b>
                        </div>
                      </div>
                      <div class="row" style="border-bottom: 1px dashed #3e3e3e3e">
                        <div class="col-md-6" i18n><b>Shipping Fee:</b></div>
                        <div class="col-md-6 text-right">
                          <b style="color: red" *ngIf="formCreate.courier.service_id">{{formCreate.courier.shipping_fee | number}} đ</b>
                          <b style="color: red" *ngIf="!formCreate.courier.service_id">---</b>
                        </div>
                      </div>
                      <div class="row" style="border-bottom: 1px dashed #3e3e3e3e">
                        <div class="col-md-6" i18n><b>Total:</b></div>
                        <div class="col-md-6 text-right"><b style="color: red">{{getTotalFee() | number}} đ</b></div>
                      </div>
                      <div><hr></div>
                      <button class="btn btn-sm btn-info" style="width: 100%" (click)="createShipment()" i18n>Create Shipment</button>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12 text-right">
                      <div class="button-group">
                        <button class="btn btn-sm btn-warning" (click)="insertTrackingModal.hide()" i18n>Cancel</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>